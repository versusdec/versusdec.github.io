(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[742],{90912:function(e,n,t){"use strict";var r=t(82066),i=t(85893);n.Z=(0,r.Z)((0,i.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox")},68426:function(e,n,t){"use strict";var r=t(82066),i=t(85893);n.Z=(0,r.Z)((0,i.jsx)("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank")},67619:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[project]/queues/[id]",function(){return t(56090)}])},61124:function(e,n,t){"use strict";t.d(n,{I:function(){return f}});var r=t(26042),i=t(69396),s=t(99534),a=t(828),u=t(85893),c=t(50135),o=t(16829),l=t(67294),d=t(66660),h=(0,o.Z)(c.Z)({"& .MuiFormHelperText-root.Mui-error":{position:"absolute",top:"100%"},"input::-webkit-outer-spin-button, input::-webkit-inner-spin-button":{WebkitAppearance:"none"},"& .MuiSelect-select":{paddingTop:21}}),f=function(e){var n=e.children,t=e.type,c=(0,s.Z)(e,["children","type"]),o=(0,a.Z)((0,l.useState)(c.value||""),2),f=o[0],m=o[1];(0,l.useEffect)(function(){m(c.value)},[c.value]);var Z=function(e){var n;null===(n=c.onChange)||void 0===n||n.call(c,e)};return"color"===t?(0,u.jsx)(d.O,(0,i.Z)((0,r.Z)({},c),{type:"text"})):(0,u.jsx)(h,(0,i.Z)((0,r.Z)({},c),{type:t,value:f,onChange:function(e){m(e.target.value),c.select&&Z(e)},onBlur:function(e){var n;c.select||Z(e),null===(n=c.handleBlur)||void 0===n||n.call(c,e)},children:n}))}},56090:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return er}});var r,i,s=t(47568),a=t(26042),u=t(69396),c=t(828),o=t(36305),l=t(70655),d=t(85893),h=t(67294),f=t(41664),m=t.n(f),Z=t(30136),v=t(26447),p=t(23795),x=t(53219),b=t(15861),g=t(87918),j=t(88409),C=t(40044),S=t(67720),y=t(99534),w=t(66242),k=t(44267),_=t(18972),T=t(83321),I=t(61124),E=function(e){e.onSubmit;var n=e.onChange,t=(e.isNew,e.userRole,e.item,e.formik),r=e.changeTab,i=(0,y.Z)(e,["onSubmit","onChange","isNew","userRole","item","formik","changeTab"]),s=(0,c.Z)((0,h.useState)(!1),2),o=s[0],l=s[1];return(0,d.jsx)(v.Z,(0,u.Z)((0,a.Z)({spacing:4},i),{children:(0,d.jsx)(w.Z,{children:(0,d.jsx)(k.Z,{children:(0,d.jsx)(v.Z,{spacing:3,children:(0,d.jsxs)(v.Z,{spacing:3,children:[(0,d.jsx)(I.I,{fullWidth:!0,label:"Name",name:"name",type:"text",error:!!(t.touched.name&&t.errors.name),helperText:t.touched.name&&t.errors.name,onBlur:t.handleBlur,onChange:function(e){t.handleChange(e),n({name:e.target.value})},value:t.values.name}),(0,d.jsx)(I.I,{fullWidth:!0,label:"Description",name:"description",type:"text",error:!!(t.touched.description&&t.errors.description),helperText:t.touched.description&&t.errors.description,onBlur:t.handleBlur,onChange:function(e){t.handleChange(e),n({description:e.target.value})},value:t.values.description}),(0,d.jsxs)(I.I,{fullWidth:!0,label:"Status",name:"status",onBlur:t.handleBlur,onChange:function(e){t.handleChange(e),n({status:e.target.value})},select:!0,value:t.values.status||"active",children:[(0,d.jsx)(_.Z,{value:"active",children:"Active"},"active"),(0,d.jsx)(_.Z,{value:"archived",children:"Archived"},"archived")]}),(0,d.jsx)(v.Z,{direction:"row",justifyContent:"end",children:(0,d.jsx)(T.Z,{size:"large",type:"submit",variant:"contained",disabled:o,onClick:function(e){l(!0),setTimeout(function(){l(!1)},500),t.handleSubmit(e),!t.isValid&&t.errors.users&&r(e,"users")},children:"Save"})})]})})})})}))},q=t(90052),B=t(85071),N=t(50135),P=t(68426),z=t(90912),O=function(e){e.onSubmit;var n=e.users,t=e.selected,r=e.formik,i=e.changeTab,s=e.handleChange,o=(0,y.Z)(e,["onSubmit","users","selected","formik","changeTab","handleChange"]),l=(0,c.Z)((0,h.useState)(!1),2),f=l[0],m=l[1];return(0,d.jsx)(d.Fragment,{children:(0,d.jsx)(v.Z,(0,u.Z)((0,a.Z)({spacing:4},o),{children:(0,d.jsx)(w.Z,{children:(0,d.jsx)(k.Z,{children:(0,d.jsxs)(v.Z,{spacing:3,children:[(0,d.jsx)(q.Z,{multiple:!0,options:n,disableCloseOnSelect:!0,getOptionLabel:function(e){return e.name},isOptionEqualToValue:function(e,n){return e.id===n.id},value:t||[],renderOption:function(e,n,t){var r=t.selected;return(0,d.jsxs)("li",(0,u.Z)((0,a.Z)({},e),{children:[(0,d.jsx)(B.Z,{icon:(0,d.jsx)(P.Z,{fontSize:"small"}),checkedIcon:(0,d.jsx)(z.Z,{fontSize:"small"}),style:{marginRight:8},checked:r}),n.name]}))},onChange:function(e,n){s(e,n)},renderInput:function(e){return(0,d.jsx)(N.Z,(0,u.Z)((0,a.Z)({},e),{fullWidth:!0,error:!!r.errors.users,helperText:r.errors.users,label:"Users",placeholder:"Select users"}))}}),(0,d.jsx)(v.Z,{direction:"row",justifyContent:"end",children:(0,d.jsx)(T.Z,{size:"large",type:"submit",variant:"contained",disabled:f,onClick:function(e){m(!0),setTimeout(function(){m(!1)},500),r.handleSubmit(e),!r.isValid&&r.errors.name&&i(e,"common")},children:"Save"})})]})})})}))})},A=t(83720),R=t(98372),V=function(e){var n=(0,A.I0)(),t=(0,A.v9)(function(e){return e.queues.get}),r=t.data,i=t.loading,s=t.error,a=(0,h.useCallback)(function(){e&&n((0,R.Ds)(e))},[e,n]);return(0,h.useEffect)(function(){a()},[n,e,a]),{data:r,loading:i,error:s}},F=t(11163),M=t(92951),D=t(4056),H=t(86501),W=t(39332),Q=t(45697),L=t.n(Q),X=t(93041),U=t(58241),G=function(e){var n=e.children,t=(0,c.Z)((0,h.useState)(!1),2),r=t[0],i=t[1],s=(0,W.useRouter)(),a=(0,M.P)().data,u=(0,U.a)(null==a?void 0:a.role_id),o=(0,h.useCallback)(function(){a&&(u.length||0===a.role_id)&&(0===a.role_id||u.includes("projects.queues.write")?i(!0):s.replace(X.H.denied))},[a,u,s]);return((0,h.useEffect)(function(){o()},[a,u,o]),r)?(0,d.jsx)(d.Fragment,{children:n}):null};G.propTypes={children:L().node};var J=t(74231),K=t(82175),Y=t(63345),$=[{label:"Common",value:"common"},{label:"Users",value:"users"}],ee=function(e,n){var t=(0,a.Z)({},e,n);for(var r in t)""===t[r]&&delete t[r];return t},en=(r=(0,s.Z)(function(e,n,t){var r,i;return(0,l.__generator)(this,function(t){switch(t.label){case 0:return r=ee(e,n),[4,D.h.queues.update(r)];case 1:return console.log(i=t.sent()),i.error?H.ZP.error("Something went wrong"):H.ZP.success("Changes saved"),[2]}})}),function(e,n,t){return r.apply(this,arguments)}),et=(i=function(){var e=(0,A.I0)(),n=(0,F.useRouter)(),t=(0,M.P)(),r=(0,c.Z)((0,h.useState)("common"),2),i=r[0],f=r[1],y=(0,c.Z)((0,h.useState)([]),2),w=y[0],k=y[1],_=(0,c.Z)((0,h.useState)([]),2),T=_[0],I=_[1],q=+n.query.id,B=+n.query.project,N=isNaN(q),P=V(q).data,z=(0,c.Z)((0,h.useState)({project_id:B,name:"",description:"",users:[],status:"active"}),2),W=z[0],Q=z[1];(0,h.useEffect)(function(){return P&&Q(P),function(){e(R.Nw.fillQueue(null))}},[e,P,q]);var L=(0,h.useCallback)((0,s.Z)(function(){var e,n;return(0,l.__generator)(this,function(t){switch(t.label){case 0:return[4,D.h.users.list({role:"operator",status:"active",limit:1e3})];case 1:return n=(e=t.sent()).result,e.error,n&&I(n.items),[2]}})}),[]);(0,h.useEffect)(function(){P&&k(P.users)},[P]),(0,h.useEffect)(function(){L()},[L]);var X=(0,h.useCallback)(function(e,n){f(n)},[]),U=(0,h.useCallback)((0,s.Z)(function(){var t,r,i,s,c;return(0,l.__generator)(this,function(l){switch(l.label){case 0:if(t=w.map(function(e){return e.id}),r=(0,u.Z)((0,a.Z)({},W),{users:(0,o.Z)(t)}),!N)return[3,8];l.label=1;case 1:return l.trys.push([1,6,,7]),[4,D.h.queues.add(r)];case 2:if(s=(i=l.sent()).result,c=i.error,!(s&&!c))return[3,4];return H.ZP.success("Queue has been created"),[4,(0,Y.D)(500)];case 3:return l.sent(),n.replace("/".concat(B,"/queues")),[3,5];case 4:H.ZP.error("Something went wrong"),l.label=5;case 5:return[3,7];case 6:return console.log(l.sent()),[3,7];case 7:return[3,9];case 8:en(W,r,e),l.label=9;case 9:return[2]}})}),[W,w,e,N,B,n]),G=(0,h.useMemo)(function(){return W},[W]),ee=J.Ry({name:J.Z_().max(255).required("Name is required"),description:J.Z_().max(255),status:J.Z_().oneOf(["active","archived"]),users:J.IX()}),et=(0,K.TA)({enableReinitialize:!0,initialValues:G,validationSchema:ee,errors:{},onSubmit:function(e,n){try{U()}catch(t){console.error(t),n.setStatus({success:!1}),n.setErrors({submit:t.message}),n.setSubmitting(!1)}}}),er=function(e){k(e)};return(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(v.Z,{spacing:4,mb:3,children:[(0,d.jsx)("div",{children:(0,d.jsxs)(p.Z,{color:"text.primary",component:m(),href:"/".concat(B,"/queues"),sx:{alignItems:"center",display:"inline-flex"},underline:"hover",children:[(0,d.jsx)(x.Z,{sx:{mr:1},children:(0,d.jsx)(Z.Z,{})}),(0,d.jsx)(b.Z,{variant:"subtitle2",children:"Queues"})]})}),(0,d.jsx)(v.Z,{alignItems:"flex-start",direction:{xs:"column",md:"row"},justifyContent:"space-between",spacing:4,children:(0,d.jsxs)(v.Z,{children:[(0,d.jsxs)(b.Z,{variant:"h4",children:[N&&"Add queue",!N&&W&&W.name]}),!N&&W&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(b.Z,{variant:"body2",color:"text.secondary",children:W.description}),(0,d.jsxs)(v.Z,{alignItems:"center",direction:"row",spacing:1,children:[(0,d.jsx)(b.Z,{variant:"subtitle2",children:"ID:"}),(0,d.jsx)(g.Z,{label:W.id,size:"small"})]})]})]})}),(0,d.jsxs)("div",{children:[(0,d.jsx)(j.Z,{indicatorColor:"primary",onChange:X,scrollButtons:"auto",sx:{mt:3},textColor:"primary",value:i,variant:"scrollable",children:$.map(function(e){return(0,d.jsx)(C.Z,{label:e.label,value:e.value},e.value)})}),(0,d.jsx)(S.Z,{})]})]}),"common"===i&&(0,d.jsx)("div",{children:(!N&&W.id||N)&&t.data&&(0,d.jsx)(E,{item:W,onSubmit:U,onChange:function(e){Q(function(n){return(0,a.Z)({},n,e)})},formik:et,changeTab:X})}),"users"===i&&(0,d.jsx)(O,{onSubmit:U,users:T,selected:w,formik:et,changeTab:X,handleChange:function(e,n){er(n)}})]})})},function(e){return(0,d.jsx)(G,{children:(0,d.jsx)(i,(0,a.Z)({},e))})}),er=et;et.defaultProps={title:"Queues"}},63345:function(e,n,t){"use strict";t.d(n,{D:function(){return r}});var r=function(e){return new Promise(function(n){return setTimeout(n,e)})}},36305:function(e,n,t){"use strict";t.d(n,{Z:function(){return a}});var r=t(20943),i=t(13375),s=t(91566);function a(e){return function(e){if(Array.isArray(e))return(0,r.Z)(e)}(e)||(0,i.Z)(e)||(0,s.Z)(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}}},function(e){e.O(0,[235,105,918,52,984,774,567,179],function(){return e(e.s=67619)}),_N_E=e.O()}]);