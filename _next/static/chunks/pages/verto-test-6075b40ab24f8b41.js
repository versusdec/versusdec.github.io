(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[125],{60566:function(t,e,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/verto-test",function(){return i(40221)}])},57427:function(t,e,i){"use strict";i.d(e,{z:function(){return r}});var s=i(26042),n=i(69396),o=i(99534),c=i(85893),a=i(83321),r=function(t){var e=t.children,i=(0,o.Z)(t,["children"]);return(0,c.jsx)(a.Z,(0,n.Z)((0,s.Z)({variant:(null==i?void 0:i.variant)?i.variant:"contained"},i),{children:e}))}},40221:function(t,e,i){"use strict";i.r(e);var s=i(47568),n=i(828),o=i(70655),c=i(85893),a=i(26447),r=i(64666),l=i(67294),h=i(3227),d=i(57427);e.default=function(){var t,e=(0,n.Z)((0,l.useState)(null),2),i=e[0],u=e[1],p=(0,n.Z)((0,l.useState)(null),2),g=p[0],b=p[1],f=(0,n.Z)((0,l.useState)(!1),2),x=f[0],k=f[1],v=(0,n.Z)((0,l.useState)(!1),2),_=v[0],w=v[1];(0,l.useEffect)(function(){var t={transportConfig:{socketUrl:"wss://ws.koala-call.com/",login:"14",passwd:"testtest"},rtcConfig:{},debug:!0},e=new h.Verto(t);return e.login(t),u(e),function(){e.logout()}},[]);var m=(t=(0,s.Z)(function(){var t,e;return(0,o.__generator)(this,function(s){switch(s.label){case 0:if(!i)return[3,2];return[4,navigator.mediaDevices.getUserMedia({audio:!0})];case 1:t=s.sent(),(e=i.call(t.getTracks(),"82222")).subscribeEvent("track",function(t){"audio"===t.kind&&new MediaStream().addTrack(t)}),b(e),s.label=2;case 2:return[2]}})}),function(){return t.apply(this,arguments)}),S=function(){g&&g.hold()},C=function(){g&&g.unhold()},j=function(t){g&&g.dtmf(t)};return(0,c.jsxs)(a.Z,{direction:"row",spacing:2,children:[(0,c.jsx)(d.z,{onClick:m,children:"Make Call"}),!x&&(0,c.jsx)(d.z,{onClick:function(){k(!0),S()},children:"Hold Call"}),x&&(0,c.jsx)(d.z,{onClick:function(){C(),k(!1)},children:"Unhold Call"}),(0,c.jsx)(d.z,{onClick:function(){g&&(g.hangup(),b(null))},children:"Hang Up"}),(0,c.jsx)(d.z,{onClick:function(){return w(!0)},children:"Send DTMF"}),(0,c.jsx)(r.Z,{open:_,onClose:function(){w(!1)},children:(0,c.jsxs)(a.Z,{direction:"row",flexWrap:"wrap",maxWidth:300,children:[(0,c.jsx)(d.z,{variant:"text",sx:{width:100,borderRadius:0},onClick:function(){j("1")},children:"1"}),(0,c.jsx)(d.z,{variant:"text",sx:{width:100,borderRadius:0},onClick:function(){j("2")},children:"2"}),(0,c.jsx)(d.z,{variant:"text",sx:{width:100,borderRadius:0},onClick:function(){j("3")},children:"3"}),(0,c.jsx)(d.z,{variant:"text",sx:{width:100,borderRadius:0},onClick:function(){j("4")},children:"4"}),(0,c.jsx)(d.z,{variant:"text",sx:{width:100,borderRadius:0},onClick:function(){j("5")},children:"5"}),(0,c.jsx)(d.z,{variant:"text",sx:{width:100,borderRadius:0},onClick:function(){j("6")},children:"6"}),(0,c.jsx)(d.z,{variant:"text",sx:{width:100,borderRadius:0},onClick:function(){j("7")},children:"7"}),(0,c.jsx)(d.z,{variant:"text",sx:{width:100,borderRadius:0},onClick:function(){j("8")},children:"8"}),(0,c.jsx)(d.z,{variant:"text",sx:{width:100,borderRadius:0},onClick:function(){j("9")},children:"9"}),(0,c.jsx)(d.z,{variant:"text",sx:{width:100,borderRadius:0},onClick:function(){j("*")},children:"*"}),(0,c.jsx)(d.z,{variant:"text",sx:{width:100,borderRadius:0},onClick:function(){j("0")},children:"0"}),(0,c.jsx)(d.z,{variant:"text",sx:{width:100,borderRadius:0},onClick:function(){j("#")},children:"#"})]})})]})}},3227:function(t,e){!function(t){"use strict";var e,i,s;class n{constructor(t,e){this.request_id=1,this.queue=[],this.callbacks=[],this.debug=!1,this.debug=e,this.options=Object.assign({},t)}initSocket_(){this.socket_=new WebSocket(this.options.socketUrl),this.socket_.onmessage=this.onMessage.bind(this),this.socket_.onclose=()=>{setTimeout(()=>{this.debug&&console.log("WSS reconnect"),this.initSocket_()},1e3)},this.socket_.onopen=()=>{let t="";for(this.reconnectHandler&&this.reconnectHandler();t=this.queue.pop();)this.socket.send(t)}}closeSocket_(){this.socket_.onclose=()=>{console.log("WebSocket is closed now.")},this.socket_.close()}get socket(){return this.socket_||this.initSocket_(),this.socket_}onMessage(t){let e;try{e=JSON.parse(t.data)}catch(i){}if(this.debug&&console.log(e),"object"==typeof e&&"jsonrpc"in e&&"2.0"===e.jsonrpc){if("method"in e)this.eventHandler(e.method,e.params);else if("result"in e&&this.callbacks[e.id]){let s=this.callbacks[e.id].success_cb;delete this.callbacks[e.id],s(Object.assign({},e.result))}else if("error"in e&&this.callbacks[e.id]){let n=this.callbacks[e.id].error_cb,o=Object.assign({},this.callbacks[e.id]);delete this.callbacks[e.id],-32e3==e.error.code&&this.options.login&&this.options.passwd?this.call("login",{login:this.options.login,passwd:this.options.passwd,loginParams:this.options.loginParams,userVariables:this.options.userVariables},t=>{this.socketCall_(o)},t=>{n(Object.assign({},e.result))}):n(Object.assign({},e.result))}}}socketCall_({request:t,success_cb:e,error_cb:i}){t.id=this.request_id++;let s=JSON.stringify(t);this.callbacks[t.id]={request:t,success_cb:e,error_cb:i},this.socket.readyState<1?(this.queue.push(s),this.debug&&console.log("Queued",s)):(this.socket.send(s),this.debug&&console.log("Sent",s))}setEventHandler(t){this.eventHandler=t}setReconnectHandler(t){this.reconnectHandler=t}call(t,e,i,s){let n={jsonrpc:"2.0",method:t,params:Object.assign({},e),id:0};this.socket&&this.socketCall_({request:n,success_cb:i,error_cb:s})}close(){this.queue=[],this.callbacks=[],this.eventHandler=null,this.reconnectHandler=null,this.closeSocket_()}}let o="undefined"!=typeof window&&void 0!==window.crypto&&void 0!==window.crypto.getRandomValues?function(){let t=new Uint16Array(8);window.crypto.getRandomValues(t);let e=function(t){let e=t.toString(16);for(;e.length<4;)e="0"+e;return e};return e(t[0])+e(t[1])+"-"+e(t[2])+"-"+e(t[3])+"-"+e(t[4])+"-"+e(t[5])+e(t[6])+e(t[7])}:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})};class c{constructor(t){this.event_handlers={},this.debug=t}subscribeEvent(t,e){let i=o();return this.event_handlers[t]||(this.event_handlers[t]=[]),this.event_handlers[t].push({id:i,code:e}),i}unsubscribeEvent(t,e){this.event_handlers[t]=e?this.event_handlers[t].map((t,i,s)=>t.id==e?void 0:t):[]}dispatchEvent(t,e){if(this.debug&&console.log("Dispatch",t,e),this.event_handlers[t])for(let i of this.event_handlers[t])i.code(e)}}t.CallDirection=void 0,(e=t.CallDirection||(t.CallDirection={}))[e.Incoming=0]="Incoming",e[e.Outgoing=1]="Outgoing",(s=i||(i={}))[s.None=0]="None",s[s.Schedulled=1]="Schedulled",s[s.MessageSent=2]="MessageSent";class a extends c{constructor(e,s,n,o){super(o),this.state=i.None,this.direction=t.CallDirection.Incoming,this.ice_timeout=n||3e3,e.iceCandidatePoolSize="iceCandidatePoolSize"in e?e.iceCandidatePoolSize:1,this.pc=new RTCPeerConnection(e),this.pc.ontrack=this.onTrack.bind(this),this.pc.onnegotiationneeded=this.onNegotiation.bind(this),this.pc.onicecandidate=this.onCandidate.bind(this),this.pc.onicegatheringstatechange=this.onIceGatheringStateChange.bind(this),void 0!==s&&(this.direction=s)}onTrack(t){this.dispatchEvent("track",t.track)}onCandidate(t){}onIceGatheringStateChange(t){"complete"==this.pc.iceGatheringState&&(this.ice_timer&&clearTimeout(this.ice_timer),this.state!=i.MessageSent&&(this.direction?this.dispatchEvent("send-offer",this.pc.localDescription):this.dispatchEvent("send-answer",this.pc.localDescription)))}iceTimerTriggered(){this.debug&&console.log(this.pc),this.state==i.Schedulled&&(this.state=i.MessageSent,this.direction?this.dispatchEvent("send-offer",this.pc.localDescription):this.dispatchEvent("send-answer",this.pc.localDescription))}onNegotiation(){this.pc.createOffer().then(t=>(this.ice_timer=setTimeout(this.iceTimerTriggered.bind(this),this.ice_timeout),this.pc.setLocalDescription(t))).then(()=>{this.state=i.Schedulled}).catch(t=>{})}getStats(){return this.pc?this.pc.getStats():Promise.reject()}onMedia(t){this.pc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:t})).then(()=>{this.debug&&console.log("got remote media")}).catch(t=>{this.debug&&console.log("remote media error",t)})}preSdp(t){this.presdp=t}addTrack(t){this.pc.addTrack(t)}answer(t){for(let e of t)this.pc.addTrack(e);this.ice_timer=setTimeout(this.iceTimerTriggered.bind(this),this.ice_timeout),this.pc.setRemoteDescription(new RTCSessionDescription({type:"offer",sdp:this.presdp})).then(()=>{this.pc.createAnswer().then(t=>{this.pc.setLocalDescription(t),this.state=i.Schedulled})})}}let r="verto.invite",l="verto.answer",h="verto.bye",d="verto.modify";class u extends c{constructor(e,i,s,n,c,h,d){super(d),this.id=n||o(),this.options=c||{},this.direction=s?t.CallDirection.Outgoing:t.CallDirection.Incoming,this.rtc=new a(e,this.direction,h,d),this.rpc=i,this.rtc.subscribeEvent("send-offer",t=>{let e=Object.assign({},this.options);e=Object.assign(e,{destination_number:s,callID:this.id}),this.rpc.call(r,{dialogParams:e,sdp:t.sdp},t=>{},t=>{})}),this.rtc.subscribeEvent("send-answer",t=>{this.rpc.call(l,{dialogParams:{destination_number:s,callID:this.id},sdp:t.sdp},t=>{},t=>{})}),this.rtc.subscribeEvent("track",t=>{this.dispatchEvent("track",t)})}getStats(){return this.rtc.getStats()}onAnswer(t){t&&this.rtc.onMedia(t),this.debug&&console.log("answer"),this.dispatchEvent("answer")}onMedia(t){this.rtc.onMedia(t),this.dispatchEvent("media")}addTrack(t){this.rtc.addTrack(t)}preSdp(t){this.rtc.preSdp(t)}answer(t){this.rtc.answer(t)}hangup(t={}){this.rpc.call(h,Object.assign({dialogParams:{callID:this.id}},t),t=>{},t=>{}),this.clear()}clear(){this.dispatchEvent("bye",this)}dtmf(t){this.rpc.call("verto.info",{dtmf:t.toString(),dialogParams:{callID:this.id}},t=>{},t=>{})}hold(t){this.rpc.call(d,{action:"hold",dialogParams:Object.assign(Object.assign({callID:this.id},this.options),t)},t=>{"held"===t.holdState?(this.holdStatus=!0,this.dispatchEvent("hold",this)):(this.holdStatus=!1,this.dispatchEvent("unhold",this))},t=>{})}unhold(t){this.rpc.call(d,{action:"unhold",dialogParams:Object.assign(Object.assign({callID:this.id},this.options),t)},t=>{"held"===t.holdState?(this.holdStatus=!0,this.dispatchEvent("hold",this)):(this.holdStatus=!1,this.dispatchEvent("unhold",this))},t=>{})}toggleHold(t){this.rpc.call(d,{action:"toggleHold",dialogParams:Object.assign(Object.assign({callID:this.id},this.options),t)},t=>{"held"===t.holdState?(this.holdStatus=!0,this.dispatchEvent("hold",this)):(this.holdStatus=!1,this.dispatchEvent("unhold",this))},t=>{})}}t.Verto=class extends c{constructor(t){super(t.debug),this.calls={},this.logged_in=!1,this.options=t,this.rpc=new n(t.transportConfig,t.debug),this.rpc.setEventHandler((t,e)=>{switch(t){case l:{let i=e.callID;this.calls[i].onAnswer(e.sdp);break}case"verto.media":{let s=e.callID;this.calls[s].onMedia(e.sdp);break}case r:{let n=new u(this.options.rtcConfig,this.rpc,"",e.callID,{caller_id_name:e.caller_id_name,caller_id_number:e.caller_id_number},this.options.ice_timeout,this.options.debug);n.preSdp(e.sdp),this.calls[e.callID]=n,this.dispatchEvent("invite",n);break}case h:this.calls[e.callID].clear(),delete this.calls[e.callID]}}),this.rpc.setReconnectHandler(()=>{this.logged_in&&this.login()}),this.options.rtcConfig=Object.assign({},this.options.rtcConfig||{})}login(){return new Promise((t,e)=>{this.rpc.call("login",{login:this.options.transportConfig.login,passwd:this.options.transportConfig.passwd},e=>{this.sessid=e.sessid,this.logged_in=!0,t(e)},t=>{e(t)})})}call(t,e,i){let s=new u(this.options.rtcConfig,this.rpc,e,o(),i,this.options.ice_timeout,this.options.debug);for(let n of t)s.addTrack(n);return this.calls[s.id]=s,s}isLogged(){return this.logged_in}logout(){this.calls&&Object.keys(this.calls).forEach(t=>{this.calls[t].hangup()}),this.rpc.close(),this.rpc=null,this.sessid=null,this.logged_in=!1}},Object.defineProperty(t,"__esModule",{value:!0})}(e)}},function(t){t.O(0,[774,567,179],function(){return t(t.s=60566)}),_N_E=t.O()}]);